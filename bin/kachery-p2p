#!/usr/bin/env python

import click
import json
import kachery_p2p as kp

@click.group(help="Kachery peer-to-peer command-line client")
def cli():
    pass

@click.command(help="Show the networks that this node belongs to.")
def get_networks():
    networks = kp.get_networks()
    for network in networks:
        print(network['networkName'])

@click.command(help="Join a network.")
@click.argument('network_name')
def join_network(network_name):
    kp.join_network(network_name)

@click.command(help="Leave a network.")
@click.argument('network_name')
def leave_network(network_name):
    kp.leave_network(network_name)

@click.command(help="Find a file.")
@click.argument('path')
def find_file(path):
    infos = kp.find_file(path)
    for info in infos:
        print(json.dumps(info, indent=4))

@click.command(help="Download a file.")
@click.argument('path')
def load_file(path):
    x = kp.load_file(path)
    print(x)

@click.command(help="Display kachery_p2p version and exit.")
def version():
    click.echo(f"This is kachery_p2p version {kp.__version__}.")
    exit()

cli.add_command(get_networks)
cli.add_command(join_network)
cli.add_command(leave_network)
cli.add_command(find_file)
cli.add_command(load_file)
cli.add_command(version)

if __name__ == "__main__":
    cli()